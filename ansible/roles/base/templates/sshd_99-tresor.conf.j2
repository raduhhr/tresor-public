# Tresor â€” SSH hardening drop-in (Debian 12)
# Loaded late to override any earlier snippets.

# Keep this in sync with group_vars (used by UFW & Fail2Ban too)
Port {{ ssh_port | default(22) }}

# Auth & access
PermitRootLogin no
PasswordAuthentication no
KbdInteractiveAuthentication no
ChallengeResponseAuthentication no
PubkeyAuthentication yes
UsePAM yes

# AllowUsers is managed by Ansible when defined via group_vars
{% if ssh_allow_users is defined and ssh_allow_users|length > 0 -%}
AllowUsers {{ ssh_allow_users | join(' ') }}
{%- else -%}
# AllowUsers not set by Tresor
{%- endif %}

# Hygiene / resilience
X11Forwarding no
ClientAliveInterval 300
ClientAliveCountMax 2
MaxAuthTries 3
LoginGraceTime 30
UseDNS no

