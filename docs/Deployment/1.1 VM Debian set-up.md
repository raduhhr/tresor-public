&nbsp;

* * *

# üß™ tresor-vm ‚Äî QA Simulation Setup

**August 2025 ‚Äì Testing ground for the Tresor homelab**  
*Last validated: **Sept 21, 2025***


`tresor-vm` is a safe, reproducible sandbox that mirrors the production homelab (‚ÄúTresor‚Äù) so you can test Debian 12 + Ansible changes without touching hardware.

* * *

##  Summary of Steps

### 0) Preparation (host)

Install virtualization tooling:

```bash
sudo apt install virt-manager qemu-kvm libvirt-daemon-system bridge-utils
```

If DNS/`virbr0` conflicts occur, adjust and restart:

```
/etc/systemd/resolved.conf
  DNS=1.1.1.1
  DNSStubListener=udp
  DNSStubListenerExtra=127.0.0.53
```

```bash
sudo pkill dnsmasq
sudo ip link delete virbr0
sudo systemctl restart systemd-resolved
sudo systemctl restart libvirtd
```

* * *

### 1) Create the VM

- **Name:** `tresor-vm`
    
- **CPU/RAM:** 4 vCPU / 8 GB RAM
    
- **Disk:** 100 GB QCOW2 ‚Üí `/mnt/tresor-vm/tresor-qa.qcow2` (thin-provisioned on SSD)
    
- **Network:** libvirt **NAT** (`virbr0`, 192.168.122.0/24)
    

**Disk layout (manual):**

- `vda1` ‚Äî ext4 ‚Äî `/`
    
- `vda5` ‚Äî swap ‚Äî 1 GB  
    *No LVM, no encryption.*
    

* * *

### 2) Debian 12 (Graphical Install)

- **ISO:** `debian-12.11.0-amd64-netinst.iso`
    
- **Hostname:** `tresor-vm`
    
- **Domain:** *(blank)*
    
- **Networking:** DHCP via `virbr0`
    
- **Users:** skip root password (locks root); create **`radu`** (sudoer)
    
- **Software selection:** ‚úÖ SSH server, ‚úÖ Standard system utilities, ‚ùå desktop
    

**Post-install state:**

- SSH reachable on DHCP IP (e.g., **192.168.122.100**)
    
- `radu` can `sudo`
    
- Root login disabled
    
- QCOW2 shows ~107 GB alloc; host mount shows ~196 GB free
    

* * *

##  Filesystem Info

| Path | Description |
| --- | --- |
| `/mnt/tresor-vm/` | Folder holding VM disk |
| `tresor-qa.qcow2` | 100 GB dynamic QCOW2 image |
| Host free space | ~196 GB on backing device |

* * *

## Simulation Goals (status)

| Component | Matches Prod? | Notes |
| --- | --- | --- |
| Debian 12 NetInstall | ‚úÖ   | Same ISO/process |
| Hostname / user model | ‚úÖ   | `tresor-vm`, `radu` sudo |
| Root login disabled | ‚úÖ   |     |
| Network model | ‚úÖ   | NAT via `virbr0` (192.168.122.0/24) |
| Disk on SSD (logic/data) | ‚úÖ   | Mirrors prod approach |
| No-touch policy via Ansible | ‚úÖ   | Prepared; verified separately |

* * *

